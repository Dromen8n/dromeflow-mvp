<!-- M√≥dulo: Gest√£o do Sistema - DromeFlow -->
<!-- Acesso exclusivo para Super Admin -->

<div class="container">
    <!-- Se√ß√£o: Unidades -->
    <div class="gestao-section" id="gestao-unidades">
        <div class="table-container">
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Nome da Unidade</th>
                            <th>Administradores</th>
                            <th>M√≥dulos</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="unitsTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    Carregando unidades...
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Bot√£o de a√ß√£o para Unidades -->
        <div class="section-actions">
            <button class="btn btn-primary" id="newUnitBtn" onclick="openUnitModal()">
                <i class="fas fa-plus"></i>
                Nova Unidade
            </button>
        </div>
    </div>

    <!-- Se√ß√£o: Administradores -->
    <div class="gestao-section hidden" id="gestao-administradores">
        <div class="table-container">
            <div class="table-wrapper">
                <table class="data-table clickable-row">
                    <thead>
                        <tr>
                            <th>E-mail</th>
                            <th>Unidades</th>
                            <th>Data de Cria√ß√£o</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="adminsTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="loading">
                                    <div class="spinner"></div>
                                    Carregando administradores...
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Card de Informa√ß√µes do Administrador -->
        <div id="adminInfoCard" style="display: none;">
            <div class="info-card">
                <h4 class="info-card-title">
                    <i class="fas fa-info-circle"></i>
                    Informa√ß√µes do Administrador
                </h4>
                
                <!-- Indicador de modo Super Admin -->
                <div id="superAdminModeIndicator" style="
                    display: none;
                    background: var(--info-color);
                    color: white;
                    padding: 0.5rem;
                    border-radius: var(--border-radius);
                    margin-bottom: 1rem;
                    font-size: 0.9rem;
                    text-align: center;
                ">
                    <i class="fas fa-crown"></i>
                    <strong>Modo Super Admin:</strong> Visualizando todos os usu√°rios do sistema
                    <br>
                    <small>üîµ Azul = Outros Admins | üü£ Roxo = Este Admin</small>
                </div>
                
                <div class="info-grid">
                    <div class="info-item">
                        <label>E-mail:</label>
                        <span id="adminEmailInfo">-</span>
                    </div>
                    <div class="info-item">
                        <label>Unidades:</label>
                        <span id="adminUnitsInfo">-</span>
                    </div>
                    <div class="info-item">
                        <label>Data de Cria√ß√£o:</label>
                        <span id="adminCreatedAtInfo">-</span>
                    </div>
                    <div class="info-item">
                        <label>Status:</label>
                        <span id="adminStatusInfo">-</span>
                    </div>
                </div>

                <!-- Tabs de Detalhes do Administrador -->
                <div class="admin-detail-tabs" style="margin-top: 1.5rem;">
                    <div class="admin-tabs-nav">
                        <button class="admin-tab-btn active" data-admin-tab="users">
                            <i class="fas fa-users"></i>
                            Usu√°rios
                        </button>
                    </div>

                    <!-- Tab: Usu√°rios do Administrador -->
                    <div class="admin-tab-content active" id="admin-tab-users">
                        <div class="tab-content-header">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h5>Permiss√µes de M√≥dulos Concedidas</h5>
                                    <small>Usu√°rios e m√≥dulos liberados pelo administrador</small>
                                </div>
                                <!-- Bot√£o para criar usu√°rio (apenas para Super Admin) -->
                                <div id="createUserBtnContainer" style="display: none;">
                                    <button class="btn btn-primary btn-sm" onclick="GestaoSistema.openCreateUserForAdmin()" title="Criar novo usu√°rio para este administrador">
                                        <i class="fas fa-user-plus"></i>
                                        Criar Usu√°rio
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="admin-users-list" id="adminUsersList">
                            <div class="loading-state">
                                <i class="fas fa-spinner fa-spin"></i>
                                Carregando dados do administrador...
                            </div>
                        </div>
                    </div>

                    <!-- Bot√£o de fechar card -->
                    <div style="text-align: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-primary);">
                        <button class="btn btn-secondary" onclick="closeAdminCard()">
                            <i class="fas fa-times"></i>
                            Fechar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bot√£o de a√ß√£o para Administradores -->
        <div class="section-actions">
            <button class="btn btn-primary" id="newAdminBtn" onclick="openAdminModal()">
                <i class="fas fa-plus"></i>
                Novo Administrador
            </button>
        </div>
    </div>
</div>

<!-- Modal: Nova Unidade -->
<div class="modal-backdrop hidden" id="unitModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="unitModalTitle">Nova Unidade</h3>
            <button class="modal-close" onclick="closeUnitModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="unitForm">
                <div class="form-group">
                    <label class="form-label">Nome da Unidade *</label>
                    <input type="text" class="form-input" id="unitName" required placeholder="Digite o nome da unidade">
                </div>
                
                <!-- Card de Informa√ß√µes da Unidade (vis√≠vel apenas em modo visualiza√ß√£o/edi√ß√£o) -->
                <div id="unitInfoCard" style="display: none;">
                    <!-- Tabs de Detalhes da Unidade (movidas para o topo) -->
                    <div class="unit-detail-tabs" style="margin-bottom: 1.5rem;">
                        <div class="unit-tabs-nav">
                            <button class="unit-tab-btn active" data-unit-tab="users">
                                <i class="fas fa-users"></i>
                                Usu√°rios
                            </button>
                            <button class="unit-tab-btn" data-unit-tab="modules">
                                <i class="fas fa-puzzle-piece"></i>
                                M√≥dulos
                            </button>
                        </div>
                    
                        <!-- Tab: Usu√°rios da Unidade -->
                        <div class="unit-tab-content active" id="unit-tab-users">
                            <div class="tab-content-header">
                                <h5>Usu√°rios da Unidade</h5>
                                <small>Administradores e usu√°rios vinculados a esta unidade</small>
                            </div>
                            <div class="unit-users-list" id="unitUsersList">
                                <div class="loading-state">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Carregando usu√°rios...
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tab: M√≥dulos da Unidade -->
                        <div class="unit-tab-content" id="unit-tab-modules">
                            <div class="tab-content-header">
                                <h5>M√≥dulos da Unidade</h5>
                                <small>Configure quais m√≥dulos est√£o ativos para esta unidade</small>
                            </div>
                            <div class="unit-modules-list" id="unitModulesList">
                                <div class="loading-state">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Carregando m√≥dulos...
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h4 class="info-card-title">
                            <i class="fas fa-info-circle"></i>
                            Informa√ß√µes da Unidade
                        </h4>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Data de Cria√ß√£o:</label>
                                <span id="unitCreatedAt">-</span>
                            </div>
                            <div class="info-item">
                                <label>Total de Usu√°rios:</label>
                                <span id="unitAdminCount">-</span>
                            </div>
                            <div class="info-item">
                                <label>Total de M√≥dulos:</label>
                                <span id="unitModuleCount">-</span>
                            </div>
                            <div class="info-item">
                                <label>Status:</label>
                                <span id="unitStatusDisplay">-</span>
                            </div>
                        </div>
                        
                        <div class="unit-actions" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-primary);">
                            <button type="button" class="btn btn-warning" onclick="window.GestaoSistema.editUnitInline()" id="editUnitBtn">
                                <i class="fas fa-edit"></i>
                                Editar Informa√ß√µes
                            </button>
                            <button type="button" class="btn btn-danger" onclick="window.GestaoSistema.deleteUnitFromModal()" id="deleteUnitBtn">
                                <i class="fas fa-trash"></i>
                                Excluir Unidade
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeUnitModal()">Cancelar</button>
            <button class="btn btn-primary" onclick="saveUnit()" id="saveUnitBtn">
                <i class="fas fa-save"></i>
                Salvar
            </button>
        </div>
    </div>
</div>

<!-- Modal: Novo/Editar Administrador -->
<div class="modal-backdrop hidden" id="adminModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="adminModalTitle">Novo Administrador</h3>
            <button class="modal-close" onclick="closeAdminModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="adminForm">
                <div class="form-group">
                    <label class="form-label">E-mail *</label>
                    <input type="email" class="form-input" id="adminEmail" required placeholder="admin@exemplo.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Senha *</label>
                    <input type="password" class="form-input" id="adminPassword" required placeholder="Digite a senha">
                </div>
                <div class="form-group">
                    <label class="form-label">Unidades *</label>
                    <div id="adminUnitsCheckbox" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-primary); border-radius: var(--border-radius); padding: 1rem;">
                        <!-- Checkbox de unidades ser√° preenchido via JS -->
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeAdminModal()">Cancelar</button>
            <button class="btn btn-primary" onclick="saveAdmin()" id="saveAdminBtn">
                <i class="fas fa-save"></i>
                Salvar
            </button>
        </div>
    </div>
</div>

<!-- Modal: Novo/Editar Usu√°rio -->
<div class="modal-backdrop hidden" id="userModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="userModalTitle">Novo Usu√°rio</h3>
            <button class="modal-close" onclick="closeUserModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="userForm">
                <div class="form-group">
                    <label class="form-label">E-mail *</label>
                    <input type="email" class="form-input" id="userEmail" required placeholder="usuario@exemplo.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Senha *</label>
                    <input type="password" class="form-input" id="userPassword" required placeholder="Digite a senha">
                </div>
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-input" id="userFullName" placeholder="Nome completo do usu√°rio">
                </div>
                <div class="form-group">
                    <label class="form-label">Unidades Permitidas *</label>
                    <div id="userUnitsCheckbox" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-primary); border-radius: var(--border-radius); padding: 1rem;">
                        <!-- Checkbox de unidades ser√° preenchido via JS -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">M√≥dulos Permitidos</label>
                    <div id="userModulesCheckbox" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-primary); border-radius: var(--border-radius); padding: 1rem;">
                        <!-- Checkbox de m√≥dulos ser√° preenchido via JS -->
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeUserModal()">Cancelar</button>
            <button class="btn btn-primary" onclick="saveUser()" id="saveUserBtn">
                <i class="fas fa-save"></i>
                Salvar
            </button>
        </div>
    </div>
</div>

<!-- Modal: Criar Usu√°rio para Administrador Espec√≠fico -->
<div class="modal-backdrop hidden" id="createUserForAdminModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Criar Usu√°rio</h3>
            <button class="modal-close" onclick="GestaoSistema.closeCreateUserForAdminModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div id="adminContextInfo" style="
                background: var(--bg-tertiary);
                padding: 1rem;
                border-radius: var(--border-radius);
                margin-bottom: 1rem;
                border-left: 4px solid var(--info-color);
            ">
                <h4 style="margin: 0 0 0.5rem 0; color: var(--text-primary); font-size: 1rem;">
                    <i class="fas fa-info-circle" style="color: var(--info-color);"></i>
                    Contexto do Administrador
                </h4>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                    Usu√°rio ser√° criado para o administrador: <strong id="contextAdminEmail">-</strong>
                </p>
            </div>
            
            <form id="createUserForAdminForm">
                <div class="form-group">
                    <label class="form-label">E-mail do Usu√°rio *</label>
                    <input type="email" class="form-input" id="newUserEmail" required placeholder="usuario@exemplo.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Senha *</label>
                    <input type="password" class="form-input" id="newUserPassword" required placeholder="Digite a senha">
                </div>
                <div class="form-group">
                    <label class="form-label">Nome Completo</label>
                    <input type="text" class="form-input" id="newUserName" placeholder="Nome completo do usu√°rio">
                </div>
                <div class="form-group">
                    <label class="form-label">Unidades do Administrador *</label>
                    <div id="adminUnitsForUser" style="max-height: 150px; overflow-y: auto; border: 1px solid var(--border-primary); border-radius: var(--border-radius); padding: 1rem; background: var(--bg-tertiary);">
                        <!-- Unidades do admin ser√£o listadas aqui -->
                    </div>
                    <small style="color: var(--text-secondary); font-size: 0.8rem;">
                        <i class="fas fa-info-circle"></i>
                        O usu√°rio ser√° automaticamente vinculado √†s unidades selecionadas acima.
                    </small>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="GestaoSistema.closeCreateUserForAdminModal()">
                Cancelar
            </button>
            <button type="button" class="btn btn-primary" id="saveUserForAdminBtn" onclick="GestaoSistema.saveUserForAdmin()">
                <i class="fas fa-user-plus"></i>
                Criar Usu√°rio
            </button>
        </div>
    </div>
</div>

<!-- Carregar JavaScript do m√≥dulo -->
<script src="js/modules/gestao-sistema.js"></script>
